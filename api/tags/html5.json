{"name":"html5","slug":"html5","count":1,"postlist":[{"title":"卡片需求记录","slug":"1-由一个需求引出的关于html5、react状态的想法","date":"2018-10-26T03:55:04.000Z","updated":"2018-11-13T08:38:20.923Z","comments":true,"path":"api/articles/1-由一个需求引出的关于html5、react状态的想法.json","excerpt":"","keywords":null,"cover":"https://i.loli.net/2018/11/13/5bea8a818ff85.jpg","content":"<ul>\n<li><h4 id=\"背景介绍\"><a href=\"#背景介绍\" class=\"headerlink\" title=\"背景介绍\"></a>背景介绍</h4>进入工作以来的第一个需求，对一个页面进行优化。<br>原页面为三张卡片，类似下图<br><img src=\"https://i.loli.net/2018/11/13/5bea8a818ff85.jpg\" width=\"200\" height=\"400\"><br>现要求将对每个卡片增加新功能，并置于一个tab下单独显示。类似下图<br><img src=\"https://i.loli.net/2018/11/13/5bea8d78aa0a3.jpg\" width=\"200\" height=\"400\"><br>经过分析，因为所需开发的组件只有一个页面需要使用，所以干脆将三个tab页开发成一个组件，仅为该页面使用。因此这里使用了对不同tab页进行ajax请求，默认初始页为第一个tab页。<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义一个函数用来切换不同tab，index根据tab切换后的顺序决定</span></span><br><span class=\"line\">changeTab:function(index)&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(index == <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.showFirstTab();</span><br><span class=\"line\">\t&#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(index == <span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.showSecondTab();</span><br><span class=\"line\">\t&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.showThirdTab();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>在开发过程中遇到两个问题卡住了很久，现总结记录一下。</p>\n<ul>\n<li><h4 id=\"需求关键点\"><a href=\"#需求关键点\" class=\"headerlink\" title=\"需求关键点\"></a>需求关键点</h4></li>\n</ul>\n<ol>\n<li>在开发的时候是以iPhone的样式为准，而安卓的样式会有一些细微的变化，需要单独判断设备然后设置不同的样式。<br>但是在开发中发现，第一个tab的内容可以根据安卓设备进行样式微调，但是当点击后面的tab后，微调的样式就无效了。 </li>\n<li>产品希望在某个tab中跳转到其他页面后，点击返回还可以到当前的tab页。</li>\n</ol>\n<ul>\n<li><h4 id=\"解决思路\"><a href=\"#解决思路\" class=\"headerlink\" title=\"解决思路\"></a>解决思路</h4></li>\n</ul>\n<ol>\n<li>为什么会出现点击tab后安卓样式无效了呢。经过分析可以发现，每次点击tab后，react会检查各个tab页下组件的不同，比如dom的不同，class的不同，然后对不同的地方进行修改。即使我对安卓设备进行了单独的设置，比如：<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> _this = <span class=\"keyword\">this</span>,isAndroid = <span class=\"keyword\">this</span>._ua.indexOf(<span class=\"string\">'Android'</span>) &gt; -<span class=\"number\">1</span> || <span class=\"keyword\">this</span>._ua.indexOf(<span class=\"string\">'Adr'</span>) &gt; -<span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(isAndroid)&#123;</span><br><span class=\"line\">\t    ...</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>可是这条代码仅在第一个tab页生效，因为第一个tab页渲染后执行当前代码，但是当切换后其他tab后，仅渲染了dom，没有执行该条语句，因此不生效。<br>解决方法就是将这些需要进行微调的代码，放入componentDidUpdate中。<br><figure class=\"highlight actionscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">componentDidUpdate:<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> _this = <span class=\"keyword\">this</span>,isAndroid = <span class=\"keyword\">this</span>._ua.indexOf(<span class=\"string\">'Android'</span>) &gt; <span class=\"number\">-1</span> || <span class=\"keyword\">this</span>._ua.indexOf(<span class=\"string\">'Adr'</span>) &gt; <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(isAndroid)&#123;</span><br><span class=\"line\">\t    ...</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<ol start=\"2\">\n<li>原本是想把tab的index存放在cookie等地方，但是自身对cookie实在是不信任，后来找到一个方法。可以利用history.replaceState，这是html5新增的一个关于历史记录的新特性。我仅需要将当前的tab的index做一个保存，然后下次从其他页面回跳的时候自动会跳到当前tab下。<figure class=\"highlight pf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">history.replaceState(&#123;tab_index:this.<span class=\"keyword\">state</span>.tab_index&#125;,null,<span class=\"string\">\"#tab=\"</span>+this.<span class=\"keyword\">state</span>.tab_index);</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n","text":"背景介绍进入工作以来的第一个需求，对一个页面进行优化。<br>原页面为三张卡片，类似下图<br> [Figure] ","link":"","raw":null,"photos":[],"categories":[{"name":"需求","slug":"需求","count":1,"path":"api/categories/需求.json"},{"name":"日常需求","slug":"需求/日常需求","count":1,"path":"api/categories/需求/日常需求.json"}],"tags":[{"name":"html5","slug":"html5","count":1,"path":"api/tags/html5.json"},{"name":"react","slug":"react","count":1,"path":"api/tags/react.json"}]}]}